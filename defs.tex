\usepackage{fmtcount}
\usepackage{xparse}
\usepackage{forloop}
\makeatletter
\def\@seccntformat#1{\csname the#1\endcsname\ }

% fixing \padzeroes in fmtcount.sty
\def\@fmtc@count#1#2\relax{%
\if\relax#1\relax
\else
\advance\@strctr by 1\relax
\@fmtc@count#2\relax
\fi}

% endtabularx inserting \AddBeforeEndtabularx if defined
\def\TX@find@end#1{%
   \def\@tempa{#1}%
   \ifx\@tempa\TX@%
      \toks@\expandafter{\the\toks@\AddBeforeEndtabularx}%
      \expandafter\TX@endtabularx
   \else\toks@\expandafter
      {\the\toks@\end{#1}}\expandafter\TX@get@body\fi}
\makeatother
\def \AddBeforeEndtabularx {}

\newcommand{\noparindent}{\setlength{\parindent}{0pt}}
\renewcommand{\thesection}{Etap \arabic{section} --}
\renewcommand{\thesubsection}{\padzeroes[3]\sectionID/\decimal{subsection}}

\makeatletter
\newenvironment{descriptionSet}[2]{
    \begingroup
    \raggedright
    \expandafter\newcommand\csname #2\endcsname[1][]{
        \if&##1&%
            \padzeroes[3]\stepcounter{enumi}\item[#1/\decimal{enumi}]
            \else\item[\ref{#1:##1}]\textbf{##1}\relax
        \fi
    }
    \begin{description}[leftmargin=6em, style=nextline]
}{\end{description}\endgroup}
\makeatother

\def\Append#1#2{\toks0={#1}%
\edef\act{\noexpand#2={\the#2 \the\toks0}}%
\act}

\def\IAppend#1#2{
\edef\act{\noexpand#2={\the#2 #1}}%
\act}

\def\trim#1{\ignorespaces#1\unskip}

\makeatletter
\pgfdeclareshape{asymmetricdiamond}
{
  \savedanchor\outernortheast{%
    %
    % Calculate width and height of diamond
    %
    \pgf@x=\pgf@xa%
    \advance\pgf@x by\pgfshapeaspect\pgf@ya%
    \pgf@y=\pgfshapeaspectinverse\pgf@xa%
    \advance\pgf@y by\pgf@ya%
    %
    % Check against minimum height/width
    %
    \pgfmathsetlength\pgf@xb{\pgfkeysvalueof{/pgf/minimum width}}%
    \pgf@xb=.5\pgf@xb%   
    \ifdim\pgf@x<\pgf@xb%
      % yes, too small. Enlarge...
      \pgf@x=\pgf@xb%
    \fi%
    \pgfmathsetlength\pgf@yb{\pgfkeysvalueof{/pgf/minimum height}}%
    \pgf@yb=.5\pgf@yb%   
    \ifdim\pgf@y<\pgf@yb%
      % yes, too small. Enlarge...
      \pgf@y=\pgf@yb%
    \fi%
    %
    % Add outer border
    %
    \pgfmathsetlength\pgf@xa{\pgfkeysvalueof{/pgf/outer xsep}}%
    \advance\pgf@x by\pgf@xa%
    \pgfmathsetlength\pgf@ya{\pgfkeysvalueof{/pgf/outer ysep}}%
    \advance\pgf@y by\pgf@ya%
  }
  \savedanchor\text{%
    \pgf@x=-.5\wd\pgfnodeparttextbox%
    \pgf@y=-.5\ht\pgfnodeparttextbox%
    \advance\pgf@y by.5\dp\pgfnodeparttextbox%
  }

  %
  % Anchors
  %
  \anchor{text}{\text}%
  \anchor{center}{\pgfpointorigin}%
  \anchor{mid}{%
    \pgf@process{\text}%
    \pgf@x=0pt%
    \pgfmathsetlength\pgf@ya{.5ex}
    \advance\pgf@y by\pgf@ya%
  }
  \anchor{base}{\pgf@process{\text}\pgf@x=0pt  }
  \anchor{north}{\pgf@process{\outernortheast}\pgf@x=0pt}
  \anchor{south}{\pgf@process{\outernortheast}\pgf@x=0pt\pgf@y=-\pgf@y}
  \anchor{west}{\pgf@process{\outernortheast}\pgf@x=-\pgf@x\pgf@y=0pt}
  \anchor{north west}{\pgf@process{\outernortheast}\pgf@x=-.5\pgf@x\pgf@y=.5\pgf@y}
  \anchor{south west}{\pgf@process{\outernortheast}\pgf@x=-.5\pgf@x\pgf@y=-.5\pgf@y}
  \anchor{east}{\pgf@process{\outernortheast}\pgf@y=0pt}
  \anchor{north east}{\pgf@process{\outernortheast}\pgf@x=.5\pgf@x\pgf@y=.5\pgf@y}
  \anchor{south east}{\pgf@process{\outernortheast}\pgf@x=.5\pgf@x\pgf@y=-.5\pgf@y}
  \anchorborder{%
    \pgf@xa=\pgf@x%
    \pgf@ya=\pgf@y%
    \pgf@process{\outernortheast}%
    \ifdim\pgf@xa>0pt%
    \else%
      \pgf@x=-\pgf@x%
    \fi%
    \ifdim\pgf@ya>0pt%
    \else%
      \pgf@y=-\pgf@y%
    \fi%
    \edef\pgf@marshal{%
      \noexpand\pgfpointintersectionoflines
      {\noexpand\pgfpointorigin}
      {\noexpand\pgfqpoint{\the\pgf@xa}{\the\pgf@ya}}
      {\noexpand\pgfqpoint{\the\pgf@x}{0pt}}
      {\noexpand\pgfqpoint{0pt}{\the\pgf@y}}%
    }%
    \pgf@process{\pgf@marshal}%
  }

  %
  % Background path
  %
  \backgroundpath{
    \pgf@process{\outernortheast}%
    \pgf@xc=\pgf@x%
    \pgf@yc=\pgf@y%
    \pgfmathsetlength{\pgf@xa}{\pgfkeysvalueof{/pgf/outer xsep}}%
    \pgfmathsetlength{\pgf@ya}{\pgfkeysvalueof{/pgf/outer ysep}}%
    \advance\pgf@xc by-1.414213\pgf@xa%
    \advance\pgf@yc by-1.414213\pgf@ya%
    \pgfpathmoveto{\pgfqpoint{\pgf@xc}{0pt}}%
    \pgfpathlineto{\pgfqpoint{0pt}{\pgf@yc}}%
    \pgfpathlineto{\pgfqpoint{-\pgf@xc}{0pt}}%
    \pgfpathlineto{\pgfqpoint{0pt}{-\pgf@yc}}%
    \pgfpathclose%
  }
}
\makeatother

\newenvironment{etap}[2][]{
\clearpage\section{#2}
\begingroup
\setcounter{enumi}{0}
\def\sectionID{#1}
\newcommand{\lsubsection}[1]{\filbreak\subsection{##1}\label{\sectionID:##1}}
}{\endgroup}

\usepackage{color}
\renewcommand{\comment}[1]{\emph{\color{red}(#1)}}

\newcolumntype{Y}{>{\raggedright\arraybackslash}X}
